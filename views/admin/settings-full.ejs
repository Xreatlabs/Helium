<html <% if (isDarkMode) { %> class="dark" <% } %>>
<head>
  <title><%= settings.name %> - Admin Settings</title>
  <link rel="icon" type="image/x-icon" href="../assets/favicon.png">
  <script>
    (function() {
      try {
        var ls = localStorage.getItem('darkMode');
        var preferDark = (ls === 'true') || (ls === null && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
        if (preferDark) document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
      } catch (e) {}
    })();
  </script>
  <link rel="stylesheet" href="../assets/tailwind.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .tab-button {
      position: relative;
    }
    .tab-button.active {
      color: #3b82f6;
    }
    .dark .tab-button.active {
      color: #60a5fa;
    }
    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: #3b82f6;
    }
    .dark .tab-button.active::after {
      background: #60a5fa;
    }
  </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-200" style="font-family: 'Inter', sans-serif;">
  <div>
    <%- include('../components/navigation') %>
    <div class="md:pl-64 flex flex-col flex-1 min-h-screen">
      <main class="flex-1 pb-8">
        <div class="py-6">
          <%- include('../components/darkmode-toggle') %>
          <%- include('../components/skeleton') %>
          <div class="hidden max-w-7xl pt-8 mx-auto px-4 sm:px-6 md:px-8" id="content">
            
            <!-- Header -->
            <div class="lg:flex lg:items-center lg:justify-between rounded-3xl mb-8">
              <div class="min-w-0 flex-1">
                <div class="flex">
                  <div class="relative">
                    <div class="bg-gray-200 dark:bg-gray-800 rounded-2xl h-11 w-11 text-center flex text-gray-400 dark:text-gray-500">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 mt-3 ml-3">
                        <path fill-rule="evenodd" d="M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </div>
                  <div class="relative ml-4">
                    <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-200 sm:truncate tracking-tight">Complete Settings</h2>
                    <p class="text-xs font-thin text-gray-500 dark:text-gray-400">Manage all application settings from here.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Success/Error Messages -->
            <% if (req.query.success) { %>
            <div class="rounded-3xl bg-green-50 dark:bg-green-900/20 p-8 mb-5 border border-green-200 dark:border-green-800">
              <div class="flex">
                <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                </svg>
                <div class="ml-3">
                  <h3 class="text-md font-medium text-green-800 dark:text-green-200">Settings updated successfully!</h3>
                  <p class="mt-1 text-sm text-green-700 dark:text-green-300">Changes may require a server restart to take effect.</p>
                </div>
              </div>
            </div>
            <% } %>

            <% if (req.query.error) { %>
            <div class="rounded-3xl bg-red-50 dark:bg-red-900/20 p-8 mb-5 border border-red-200 dark:border-red-800">
              <div class="flex">
                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                </svg>
                <div class="ml-3">
                  <h3 class="text-md font-medium text-red-800 dark:text-red-200">Error updating settings</h3>
                  <p class="mt-1 text-sm text-red-700 dark:text-red-300"><%= req.query.error %></p>
                </div>
              </div>
            </div>
            <% } %>

            <!-- Tabs Navigation -->
            <div class="border-b border-gray-200 dark:border-gray-700 mb-8">
              <nav class="-mb-px flex space-x-8 overflow-x-auto">
                <button onclick="showTab('general')" class="tab-button active whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  General
                </button>
                <button onclick="showTab('announcement')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Announcement
                </button>
                <button onclick="showTab('socialmedia')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Social Media
                </button>
                <button onclick="showTab('health')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Health Monitoring
                </button>
                <button onclick="showTab('pterodactyl')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Pterodactyl
                </button>
                <button onclick="showTab('oauth')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  OAuth2
                </button>
                <button onclick="showTab('ratelimits')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Rate Limits
                </button>
                <button onclick="showTab('api')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  API & Bot
                </button>
                <button onclick="showTab('permissions')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Permissions
                </button>
                <button onclick="showTab('packages')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Packages
                </button>
                <button onclick="showTab('usermaxres')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  User Max Resources
                </button>
                <button onclick="showTab('coins')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Coins & Store
                </button>
                <button onclick="showTab('renewal')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Renewal System
                </button>
                <button onclick="showTab('linkvertise')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Linkvertise
                </button>
                <button onclick="showTab('afk')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  AFK System
                </button>
                <button onclick="showTab('security')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Security
                </button>
                <button onclick="showTab('logging')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Logging
                </button>
                <button onclick="showTab('codes')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600">
                  Codes
                </button>
              </nav>
            </div>

            <!-- Tab Content -->
            <div id="tab-general" class="tab-content">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">General Settings</h3>
                <form id="form-general" onsubmit="saveSettings(event, 'general')">
                  <div class="space-y-6">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Site Name</label>
                      <input type="text" name="name" value="<%= settings.name %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Version</label>
                      <input type="text" name="version" value="<%= settings.version %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Timezone</label>
                      <input type="text" name="timezone" value="<%= settings.timezone %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Website Port</label>
                      <input type="number" name="website.port" value="<%= settings.website.port %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Website Secret</label>
                      <input type="text" name="website.secret" value="<%= settings.website.secret %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Database Connection</label>
                      <input type="text" name="database" value="<%= settings.database %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">SQLite connection string (requires restart)</p>
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="testing" <%= settings.testing ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Testing Mode</label>
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.accountSwitcher" <%= settings.api?.client?.accountSwitcher ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Account Switcher</label>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save General Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-announcement" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Announcement Banner Settings</h3>
                <form id="form-announcement" onsubmit="saveSettings(event, 'announcement')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="announcement.enabled" <%= settings.announcement?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Announcement Banner</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Announcement Message</label>
                      <textarea name="announcement.message" rows="3"
                        placeholder="Enter your announcement message..."
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"><%= settings.announcement?.message || '' %></textarea>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">This message will be displayed to all users on the dashboard</p>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Banner Type</label>
                      <select name="announcement.type" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        <option value="info" <%= settings.announcement?.type === 'info' ? 'selected' : '' %>>Info (Blue)</option>
                        <option value="success" <%= settings.announcement?.type === 'success' ? 'selected' : '' %>>Success (Green)</option>
                        <option value="warning" <%= settings.announcement?.type === 'warning' ? 'selected' : '' %>>Warning (Yellow)</option>
                        <option value="error" <%= settings.announcement?.type === 'error' ? 'selected' : '' %>>Error (Red)</option>
                      </select>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Choose the color theme for the announcement</p>
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="announcement.dismissible" <%= settings.announcement?.dismissible ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Allow users to dismiss the announcement</label>
                    </div>
                    
                    <!-- Preview -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100 mb-3">Preview</h4>
                      <div id="announcement-preview" class="rounded-lg p-4 border">
                        <!-- Preview will be rendered here -->
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Announcement Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-socialmedia" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">Social Media Links</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Configure social media and external links displayed on your dashboard</p>
                
                <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                  <p class="text-sm text-blue-800 dark:text-blue-200">💡 <strong>Tip:</strong> These links will be displayed in the footer and navigation areas. Enable/disable individual links as needed.</p>
                </div>

                <!-- Enable/Disable Section -->
                <div class="mb-6">
                  <div class="flex items-center">
                    <input type="checkbox" id="social-media-enabled" <%= settings.socialMedia?.enabled ? 'checked' : '' %> 
                      class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                    <label for="social-media-enabled" class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Social Media Links</label>
                  </div>
                </div>

                <!-- Social Media Links List -->
                <div id="social-media-links" class="space-y-4 mb-6">
                  <% 
                  const socialLinks = settings.socialMedia?.links || [];
                  if (socialLinks.length > 0) {
                    socialLinks.forEach((link, index) => {
                  %>
                  <div class="social-link-item border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900" data-index="<%= index %>">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Platform Name</label>
                        <input type="text" class="link-name w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" 
                          value="<%= link.name %>" placeholder="Discord">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Icon</label>
                        <select class="link-icon w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                          <optgroup label="Social Media">
                            <option value="discord" <%= link.icon === 'discord' ? 'selected' : '' %>>Discord</option>
                            <option value="twitter" <%= link.icon === 'twitter' ? 'selected' : '' %>>Twitter/X</option>
                            <option value="instagram" <%= link.icon === 'instagram' ? 'selected' : '' %>>Instagram</option>
                            <option value="youtube" <%= link.icon === 'youtube' ? 'selected' : '' %>>YouTube</option>
                            <option value="github" <%= link.icon === 'github' ? 'selected' : '' %>>GitHub</option>
                            <option value="facebook" <%= link.icon === 'facebook' ? 'selected' : '' %>>Facebook</option>
                            <option value="tiktok" <%= link.icon === 'tiktok' ? 'selected' : '' %>>TikTok</option>
                            <option value="reddit" <%= link.icon === 'reddit' ? 'selected' : '' %>>Reddit</option>
                            <option value="linkedin" <%= link.icon === 'linkedin' ? 'selected' : '' %>>LinkedIn</option>
                            <option value="twitch" <%= link.icon === 'twitch' ? 'selected' : '' %>>Twitch</option>
                          </optgroup>
                          <optgroup label="Services & Pages">
                            <option value="website" <%= link.icon === 'website' ? 'selected' : '' %>>🌐 Website/Home</option>
                            <option value="panel" <%= link.icon === 'panel' ? 'selected' : '' %>>⚙️ Control Panel</option>
                            <option value="status" <%= link.icon === 'status' ? 'selected' : '' %>>📊 Status Page</option>
                            <option value="docs" <%= link.icon === 'docs' ? 'selected' : '' %>>📚 Documentation</option>
                            <option value="support" <%= link.icon === 'support' ? 'selected' : '' %>>💬 Support/Help</option>
                            <option value="blog" <%= link.icon === 'blog' ? 'selected' : '' %>>📝 Blog</option>
                            <option value="store" <%= link.icon === 'store' ? 'selected' : '' %>>🛒 Store/Shop</option>
                            <option value="community" <%= link.icon === 'community' ? 'selected' : '' %>>👥 Community/Forum</option>
                            <option value="wiki" <%= link.icon === 'wiki' ? 'selected' : '' %>>📖 Wiki</option>
                            <option value="api" <%= link.icon === 'api' ? 'selected' : '' %>>🔌 API Docs</option>
                            <option value="billing" <%= link.icon === 'billing' ? 'selected' : '' %>>💳 Billing</option>
                            <option value="downloads" <%= link.icon === 'downloads' ? 'selected' : '' %>>⬇️ Downloads</option>
                            <option value="news" <%= link.icon === 'news' ? 'selected' : '' %>>📰 News</option>
                          </optgroup>
                          <optgroup label="General">
                            <option value="link" <%= link.icon === 'link' ? 'selected' : '' %>>🔗 Generic Link</option>
                            <option value="email" <%= link.icon === 'email' ? 'selected' : '' %>>📧 Email</option>
                          </optgroup>
                        </select>
                      </div>
                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">URL</label>
                        <div class="flex gap-2">
                          <input type="url" class="link-url flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" 
                            value="<%= link.url %>" placeholder="https://...">
                          <div class="flex items-center gap-2">
                            <input type="checkbox" class="link-enabled h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600" 
                              <%= link.enabled ? 'checked' : '' %>>
                            <label class="text-sm text-gray-600 dark:text-gray-400">Enabled</label>
                            <button type="button" onclick="removeSocialLink(this)" class="ml-2 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition">
                              Remove
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% 
                    });
                  }
                  %>
                </div>

                <button type="button" onclick="addSocialLink()" class="mb-6 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition">
                  + Add Social Link
                </button>

                <form id="form-socialmedia" onsubmit="saveSocialMedia(event)">
                  <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Social Media Links
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-health" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">Health-Based Monitoring</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Monitor system health and get alerts when issues are detected</p>
                
                <!-- Current Health Status -->
                <div class="mb-8 p-6 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700">
                  <div class="flex items-center justify-between mb-4">
                    <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100">Current Health Status</h4>
                    <button type="button" onclick="refreshHealthStatus()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition">
                      Refresh
                    </button>
                  </div>
                  <div id="health-status-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Health status will be loaded here -->
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400 col-span-2">
                      <svg class="animate-spin h-8 w-8 mx-auto mb-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      <p>Loading health status...</p>
                    </div>
                  </div>
                </div>

                <form id="form-health" onsubmit="saveSettings(event, 'health')">
                  <div class="space-y-6">
                    <!-- Enable/Disable -->
                    <div class="flex items-center mb-4">
                      <input type="checkbox" name="api.client.healthMonitoring.enabled" <%= settings.api?.client?.healthMonitoring?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Health Monitoring</label>
                    </div>

                    <!-- Check Interval -->
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Check Interval (seconds)</label>
                      <input type="number" name="api.client.healthMonitoring.checkInterval" value="<%= settings.api?.client?.healthMonitoring?.checkInterval || 60 %>" 
                        min="30" max="3600"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">How often to run health checks (30-3600 seconds)</p>
                    </div>

                    <!-- What to Check -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Health Checks</h4>
                      <div class="space-y-3">
                        <div class="flex items-center">
                          <input type="checkbox" name="api.client.healthMonitoring.checks.pterodactyl" <%= settings.api?.client?.healthMonitoring?.checks?.pterodactyl ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Pterodactyl Panel Connection</label>
                        </div>
                        <div class="flex items-center">
                          <input type="checkbox" name="api.client.healthMonitoring.checks.database" <%= settings.api?.client?.healthMonitoring?.checks?.database ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Database Connectivity</label>
                        </div>
                        <div class="flex items-center">
                          <input type="checkbox" name="api.client.healthMonitoring.checks.diskSpace" <%= settings.api?.client?.healthMonitoring?.checks?.diskSpace ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Disk Space Usage</label>
                        </div>
                        <div class="flex items-center">
                          <input type="checkbox" name="api.client.healthMonitoring.checks.memory" <%= settings.api?.client?.healthMonitoring?.checks?.memory ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Memory Usage</label>
                        </div>
                      </div>
                    </div>

                    <!-- Thresholds -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Alert Thresholds (%)</h4>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Disk Space Warning</label>
                          <input type="number" name="api.client.healthMonitoring.thresholds.diskSpaceWarning" value="<%= settings.api?.client?.healthMonitoring?.thresholds?.diskSpaceWarning || 80 %>" 
                            min="0" max="100"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Disk Space Critical</label>
                          <input type="number" name="api.client.healthMonitoring.thresholds.diskSpaceCritical" value="<%= settings.api?.client?.healthMonitoring?.thresholds?.diskSpaceCritical || 90 %>" 
                            min="0" max="100"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Memory Warning</label>
                          <input type="number" name="api.client.healthMonitoring.thresholds.memoryWarning" value="<%= settings.api?.client?.healthMonitoring?.thresholds?.memoryWarning || 80 %>" 
                            min="0" max="100"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Memory Critical</label>
                          <input type="number" name="api.client.healthMonitoring.thresholds.memoryCritical" value="<%= settings.api?.client?.healthMonitoring?.thresholds?.memoryCritical || 90 %>" 
                            min="0" max="100"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                    </div>

                    <!-- Webhook Alerts -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Alert Notifications</h4>
                      <div class="flex items-center mb-4">
                        <input type="checkbox" name="api.client.healthMonitoring.alerts.webhook" <%= settings.api?.client?.healthMonitoring?.alerts?.webhook ? 'checked' : '' %> 
                          class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                        <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Send Alerts to Webhook</label>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Webhook URL</label>
                        <input type="text" name="api.client.healthMonitoring.alerts.webhookUrl" value="<%= settings.api?.client?.healthMonitoring?.alerts?.webhookUrl || '' %>" 
                          placeholder="https://discord.com/api/webhooks/..."
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Discord webhook for health alerts (separate from main webhook)</p>
                      </div>
                    </div>

                    <div class="mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                      <p class="text-xs text-blue-800 dark:text-blue-200">💡 <strong>Tip:</strong> Health monitoring runs in the background and checks system status at the specified interval. Alerts are sent when thresholds are exceeded.</p>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Health Monitoring Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-pterodactyl" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Pterodactyl Panel Settings</h3>
                <form id="form-pterodactyl" onsubmit="saveSettings(event, 'pterodactyl')">
                  <div class="space-y-6">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Panel Domain</label>
                      <input type="text" name="pterodactyl.domain" value="<%= settings.pterodactyl?.domain || '' %>" 
                        placeholder="https://panel.example.com"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Full URL including https://</p>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">API Key</label>
                      <input type="password" name="pterodactyl.key" value="<%= settings.pterodactyl?.key || '' %>" 
                        placeholder="ptla_..."
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Application API key from your Pterodactyl panel</p>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Pterodactyl Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-oauth" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">OAuth2 Settings (Discord)</h3>
                <form id="form-oauth" onsubmit="saveSettings(event, 'oauth')">
                  <div class="space-y-6">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Client ID</label>
                      <input type="text" name="api.client.oauth2.id" value="<%= settings.api?.client?.oauth2?.id || '' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Client Secret</label>
                      <input type="password" name="api.client.oauth2.secret" value="<%= settings.api?.client?.oauth2?.secret || '' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Callback URL</label>
                      <input type="text" name="api.client.oauth2.link" value="<%= settings.api?.client?.oauth2?.link || '' %>" 
                        placeholder="https://dashboard.example.com"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Callback Path</label>
                      <input type="text" name="api.client.oauth2.callbackpath" value="<%= settings.api?.client?.oauth2?.callbackpath || '/callback' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.oauth2.prompt" <%= settings.api?.client?.oauth2?.prompt ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Force Consent Prompt</label>
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.oauth2.ip.trust x-forwarded-for" <%= settings.api?.client?.oauth2?.ip?.['trust x-forwarded-for'] ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Trust X-Forwarded-For Header</label>
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.oauth2.ip.duplicate check" <%= settings.api?.client?.oauth2?.ip?.['duplicate check'] ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Enable Duplicate IP Check</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Blocked IPs (one per line)</label>
                      <textarea name="api.client.oauth2.ip.block" rows="3" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                        placeholder="192.168.1.1"><%= settings.api?.client?.oauth2?.ip?.block ? (Array.isArray(settings.api.client.oauth2.ip.block) ? settings.api.client.oauth2.ip.block.join('\n') : settings.api.client.oauth2.ip.block) : '' %></textarea>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Block specific IPs from accessing the dashboard</p>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save OAuth2 Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-ratelimits" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Rate Limits</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Configure rate limits for different endpoints (requests per time window)</p>
                <form id="form-ratelimits" onsubmit="saveSettings(event, 'ratelimits')">
                  <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/callback</label>
                        <input type="number" name="api.client.ratelimits./callback" value="<%= settings.api?.client?.ratelimits?.['/callback'] || 2 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/create</label>
                        <input type="number" name="api.client.ratelimits./create" value="<%= settings.api?.client?.ratelimits?.['/create'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/delete</label>
                        <input type="number" name="api.client.ratelimits./delete" value="<%= settings.api?.client?.ratelimits?.['/delete'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/modify</label>
                        <input type="number" name="api.client.ratelimits./modify" value="<%= settings.api?.client?.ratelimits?.['/modify'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/updateinfo</label>
                        <input type="number" name="api.client.ratelimits./updateinfo" value="<%= settings.api?.client?.ratelimits?.['/updateinfo'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/setplan</label>
                        <input type="number" name="api.client.ratelimits./setplan" value="<%= settings.api?.client?.ratelimits?.['/setplan'] || 2 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/admin</label>
                        <input type="number" name="api.client.ratelimits./admin" value="<%= settings.api?.client?.ratelimits?.['/admin'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/regen</label>
                        <input type="number" name="api.client.ratelimits./regen" value="<%= settings.api?.client?.ratelimits?.['/regen'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/renew</label>
                        <input type="number" name="api.client.ratelimits./renew" value="<%= settings.api?.client?.ratelimits?.['/renew'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/api/userinfo</label>
                        <input type="number" name="api.client.ratelimits./api/userinfo" value="<%= settings.api?.client?.ratelimits?.['/api/userinfo'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">/linkvertise/callback</label>
                        <input type="number" name="api.client.ratelimits./linkvertise/callback" value="<%= settings.api?.client?.ratelimits?.['/linkvertise/callback'] || 1 %>" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Rate Limit Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-api" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700 mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">API Settings</h3>
                <form id="form-api" onsubmit="saveSettings(event, 'api')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.api.enabled" <%= settings.api?.client?.api?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable API</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">API Code</label>
                      <input type="password" name="api.client.api.code" value="<%= settings.api?.client?.api?.code || '' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Secret key for API access</p>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save API Settings
                  </button>
                </form>
              </div>

              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700 mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Discord Bot Settings</h3>
                <form id="form-bot" onsubmit="saveSettings(event, 'bot')">
                  <div class="space-y-6">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bot Token</label>
                      <input type="password" name="api.client.bot.token" value="<%= settings.api?.client?.bot?.token || '' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Auto Join Guild</h4>
                      <div class="flex items-center mb-4">
                        <input type="checkbox" name="api.client.bot.joinguild.enabled" <%= settings.api?.client?.bot?.joinguild?.enabled ? 'checked' : '' %> 
                          class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                        <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Enable Auto Join</label>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Guild IDs (one per line)</label>
                        <textarea name="api.client.bot.joinguild.guildid" rows="3" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                          placeholder="Guild ID"><%= settings.api?.client?.bot?.joinguild?.guildid ? (Array.isArray(settings.api.client.bot.joinguild.guildid) ? settings.api.client.bot.joinguild.guildid.join('\n') : settings.api.client.bot.joinguild.guildid) : '' %></textarea>
                      </div>
                    </div>
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Give Role on Login</h4>
                      <div class="flex items-center mb-4">
                        <input type="checkbox" name="api.client.bot.giverole.enabled" <%= settings.api?.client?.bot?.giverole?.enabled ? 'checked' : '' %> 
                          class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                        <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Enable Auto Role</label>
                      </div>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Guild ID</label>
                          <input type="text" name="api.client.bot.giverole.guildid" value="<%= settings.api?.client?.bot?.giverole?.guildid || '' %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Role ID</label>
                          <input type="text" name="api.client.bot.giverole.roleid" value="<%= settings.api?.client?.bot?.giverole?.roleid || '' %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Bot Settings
                  </button>
                </form>
              </div>

              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">J4R (Join for Rewards)</h3>
                <form id="form-j4r" onsubmit="saveSettings(event, 'j4r')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.j4r.enabled" <%= settings.api?.client?.j4r?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable J4R System</label>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Note: J4R ads configuration requires manual JSON editing in settings.json</p>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save J4R Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-permissions" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700 mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">User Permissions</h3>
                <form id="form-permissions" onsubmit="saveSettings(event, 'permissions')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.allow.newusers" <%= settings.api?.client?.allow?.newusers ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Allow New Users to Register</label>
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.allow.regen" <%= settings.api?.client?.allow?.regen ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Allow Password Regeneration</label>
                    </div>
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.allow.overresourcessuspend" <%= settings.api?.client?.allow?.overresourcessuspend ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Suspend on Over Resources</label>
                    </div>
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Server Permissions</h4>
                      <div class="space-y-2">
                        <label class="flex items-center">
                          <input type="checkbox" name="api.client.allow.server.create" <%= settings.api?.client?.allow?.server?.create ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Allow Server Creation</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="api.client.allow.server.modify" <%= settings.api?.client?.allow?.server?.modify ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Allow Server Modification</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="api.client.allow.server.delete" <%= settings.api?.client?.allow?.server?.delete ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Allow Server Deletion</span>
                        </label>
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Permission Settings
                  </button>
                </form>
              </div>

              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Password Generator</h3>
                <form id="form-password" onsubmit="saveSettings(event, 'password')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.passwordgenerator.signup" <%= settings.api?.client?.passwordgenerator?.signup ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Generate Password on Signup</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password Length</label>
                      <input type="number" name="api.client.passwordgenerator.length" value="<%= settings.api?.client?.passwordgenerator?.length || 16 %>" 
                        min="8" max="64"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Password Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-packages" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Packages & Resources</h3>
                <form id="form-packages" onsubmit="saveSettings(event, 'packages')">
                  <div class="space-y-6">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Package</label>
                      <input type="text" name="api.client.packages.default" value="<%= settings.api?.client?.packages?.default || 'default' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-2">Default Package Resources (Starting Resources)</h4>
                      <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Initial resources given to users when they sign up</p>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">RAM (MB)</label>
                          <input type="number" name="api.client.packages.list.default.ram" value="<%= settings.api?.client?.packages?.list?.default?.ram || 1024 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Disk (MB)</label>
                          <input type="number" name="api.client.packages.list.default.disk" value="<%= settings.api?.client?.packages?.list?.default?.disk || 1024 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">CPU (%)</label>
                          <input type="number" name="api.client.packages.list.default.cpu" value="<%= settings.api?.client?.packages?.list?.default?.cpu || 100 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Server Slots</label>
                          <input type="number" name="api.client.packages.list.default.servers" value="<%= settings.api?.client?.packages?.list?.default?.servers || 2 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                    </div>
                    
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-2">Maximum Package Resources (Resource Caps)</h4>
                      <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Maximum resources users can have (including purchases from store). Leave at 0 for unlimited.</p>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max RAM (MB)</label>
                          <input type="number" name="api.client.packages.list.default.max.ram" value="<%= settings.api?.client?.packages?.list?.default?.max?.ram || 0 %>" 
                            placeholder="0 = unlimited"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Disk (MB)</label>
                          <input type="number" name="api.client.packages.list.default.max.disk" value="<%= settings.api?.client?.packages?.list?.default?.max?.disk || 0 %>" 
                            placeholder="0 = unlimited"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max CPU (%)</label>
                          <input type="number" name="api.client.packages.list.default.max.cpu" value="<%= settings.api?.client?.packages?.list?.default?.max?.cpu || 0 %>" 
                            placeholder="0 = unlimited"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Server Slots</label>
                          <input type="number" name="api.client.packages.list.default.max.servers" value="<%= settings.api?.client?.packages?.list?.default?.max?.servers || 0 %>" 
                            placeholder="0 = unlimited"
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                      <div class="mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                        <p class="text-xs text-blue-800 dark:text-blue-200">💡 <strong>Tip:</strong> Maximum resources prevent users from buying unlimited resources from the store. Set to 0 to allow unlimited purchases.</p>
                      </div>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-4">Note: Advanced package configuration (locations, eggs, role packages) requires manual JSON editing in settings.json</p>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Package Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-usermaxres" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">User-Specific Maximum Resources</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Override package max limits for specific Discord users. These limits take priority over package max settings.</p>
                
                <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                  <p class="text-sm text-blue-800 dark:text-blue-200">💡 <strong>How it works:</strong> Enter a Discord ID to set custom max resources for that user. Set to 0 for unlimited, or leave fields empty to use package defaults.</p>
                </div>

                <div id="userMaxResourcesList" class="space-y-4">
                  <% 
                  const userMaxRes = settings.api?.client?.userMaxResources || {};
                  const userEntries = Object.entries(userMaxRes).filter(([key]) => !key.startsWith('_'));
                  if (userEntries.length > 0) {
                    userEntries.forEach(([discordId, limits], index) => {
                  %>
                  <div class="user-max-res-item border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900" data-index="<%= index %>">
                    <div class="flex justify-between items-start mb-4">
                      <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Discord ID</label>
                        <input type="text" name="api.client.userMaxResources.<%= discordId %>.id" value="<%= discordId %>" 
                          class="discord-id-input w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                          placeholder="123456789012345678" data-original-id="<%= discordId %>">
                      </div>
                      <button type="button" onclick="removeUserMaxRes(this)" class="ml-4 mt-7 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition">
                        Remove
                      </button>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max RAM (MB)</label>
                        <input type="number" name="api.client.userMaxResources.<%= discordId %>.ram" value="<%= limits.ram || 0 %>" 
                          placeholder="0 = unlimited"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Disk (MB)</label>
                        <input type="number" name="api.client.userMaxResources.<%= discordId %>.disk" value="<%= limits.disk || 0 %>" 
                          placeholder="0 = unlimited"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max CPU (%)</label>
                        <input type="number" name="api.client.userMaxResources.<%= discordId %>.cpu" value="<%= limits.cpu || 0 %>" 
                          placeholder="0 = unlimited"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Server Slots</label>
                        <input type="number" name="api.client.userMaxResources.<%= discordId %>.servers" value="<%= limits.servers || 0 %>" 
                          placeholder="0 = unlimited"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      </div>
                    </div>
                  </div>
                  <% 
                    });
                  }
                  %>
                </div>

                <button type="button" onclick="addUserMaxRes()" class="mt-4 px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition">
                  + Add User
                </button>

                <form id="form-usermaxres" onsubmit="saveUserMaxRes(event)" class="mt-6">
                  <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save User Max Resources
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-coins" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Coins & Store Settings</h3>
                <form id="form-coins" onsubmit="saveSettings(event, 'coins')">
                  <div class="space-y-6">
                    <div class="flex items-center mb-4">
                      <input type="checkbox" name="api.client.coins.enabled" <%= settings.api?.client?.coins?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Coins System</label>
                    </div>
                    <div class="flex items-center mb-6">
                      <input type="checkbox" name="api.client.coins.store.enabled" <%= settings.api?.client?.coins?.store?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Resource Store</label>
                    </div>
                    
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">RAM Store Pricing</h4>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cost (coins)</label>
                          <input type="number" name="api.client.coins.store.ram.cost" value="<%= settings.api?.client?.coins?.store?.ram?.cost || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Per (MB)</label>
                          <input type="number" name="api.client.coins.store.ram.per" value="<%= settings.api?.client?.coins?.store?.ram?.per || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                    </div>

                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Disk Store Pricing</h4>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cost (coins)</label>
                          <input type="number" name="api.client.coins.store.disk.cost" value="<%= settings.api?.client?.coins?.store?.disk?.cost || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Per (MB)</label>
                          <input type="number" name="api.client.coins.store.disk.per" value="<%= settings.api?.client?.coins?.store?.disk?.per || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                    </div>

                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">CPU Store Pricing</h4>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cost (coins)</label>
                          <input type="number" name="api.client.coins.store.cpu.cost" value="<%= settings.api?.client?.coins?.store?.cpu?.cost || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Per (%)</label>
                          <input type="number" name="api.client.coins.store.cpu.per" value="<%= settings.api?.client?.coins?.store?.cpu?.per || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                    </div>

                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Server Slots Pricing</h4>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cost (coins)</label>
                          <input type="number" name="api.client.coins.store.servers.cost" value="<%= settings.api?.client?.coins?.store?.servers?.cost || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Per (slots)</label>
                          <input type="number" name="api.client.coins.store.servers.per" value="<%= settings.api?.client?.coins?.store?.servers?.per || 0 %>" 
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        </div>
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Coins Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-renewal" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Server Renewal System</h3>
                <form id="form-renewal" onsubmit="saveSettings(event, 'renewal')">
                  <div class="space-y-6">
                    <!-- Enable Renewal System -->
                    <div class="flex items-center mb-4">
                      <input type="checkbox" name="api.client.allow.renewsuspendsystem.enabled" <%= settings.api?.client?.allow?.renewsuspendsystem?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Renewal System</label>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                      <p class="text-sm text-blue-800 dark:text-blue-300">
                        <strong>Note:</strong> When enabled, servers will expire after the renewal period and require coins to renew. Expired servers can be auto-suspended and optionally deleted.
                      </p>
                    </div>

                    <!-- Renewal Period -->
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Renewal Period (days)</label>
                      <input type="number" name="api.client.allow.renewsuspendsystem.renewalperiod" value="<%= settings.api?.client?.allow?.renewsuspendsystem?.renewalperiod || 30 %>" 
                        min="1" max="365"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">How many days a server lasts before requiring renewal</p>
                    </div>

                    <!-- Renewal Cost -->
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Renewal Cost (coins)</label>
                      <input type="number" name="api.client.allow.renewsuspendsystem.renewalcost" value="<%= settings.api?.client?.allow?.renewsuspendsystem?.renewalcost || 100 %>" 
                        min="0"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Coins required to renew a server for the renewal period</p>
                    </div>

                    <!-- Grace Period -->
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Grace Period (days)</label>
                      <input type="number" name="api.client.allow.renewsuspendsystem.graceperiod" value="<%= settings.api?.client?.allow?.renewsuspendsystem?.graceperiod || 3 %>" 
                        min="0" max="30"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Days after expiration before auto-suspension kicks in</p>
                    </div>

                    <!-- Auto Suspend -->
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.allow.renewsuspendsystem.autosuspend" <%= settings.api?.client?.allow?.renewsuspendsystem?.autosuspend ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Auto-Suspend Expired Servers</label>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 -mt-4 ml-6">Automatically suspend servers after grace period expires</p>

                    <!-- Auto Renewal -->
                    <div class="flex items-center mt-4">
                      <input type="checkbox" name="api.client.allow.renewsuspendsystem.autorenewal" <%= settings.api?.client?.allow?.renewsuspendsystem?.autorenewal ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Auto-Renewal Feature</label>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 -mt-4 ml-6">Allow users to enable automatic renewal if they have enough coins</p>

                    <!-- Deletion Period -->
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Deletion Period (days)</label>
                      <input type="number" name="api.client.allow.renewsuspendsystem.deletionperiod" value="<%= settings.api?.client?.allow?.renewsuspendsystem?.deletionperiod || 7 %>" 
                        min="0" max="90"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Days after suspension before server is permanently deleted (0 = no auto-deletion)</p>
                    </div>

                    <!-- Warning Box -->
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                      <div class="flex">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                        </svg>
                        <div class="ml-3">
                          <h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-300">Important</h3>
                          <p class="mt-1 text-xs text-yellow-700 dark:text-yellow-400">Changes to renewal settings require a server restart. The cron job runs every hour to check for expired servers.</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Renewal Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-linkvertise" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Linkvertise Settings</h3>
                <form id="form-linkvertise" onsubmit="saveSettings(event, 'linkvertise')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="api.client.linkvertise.enabled" <%= settings.api?.client?.linkvertise?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Linkvertise</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">User ID</label>
                      <input type="text" name="api.client.linkvertise.userId" value="<%= settings.api?.client?.linkvertise?.userId || '' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Base URL</label>
                      <input type="text" name="api.client.linkvertise.baseUrl" value="<%= settings.api?.client?.linkvertise?.baseUrl || 'https://link-to.net' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Domain</label>
                      <input type="text" name="api.client.linkvertise.domain" value="<%= settings.api?.client?.linkvertise?.domain || '' %>" 
                        placeholder="https://dashboard.example.com"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Reward Coins</label>
                      <input type="number" name="api.client.linkvertise.rewardCoins" value="<%= settings.api?.client?.linkvertise?.rewardCoins || 10 %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cooldown Time (seconds)</label>
                      <input type="number" name="api.client.linkvertise.cooldownTime" value="<%= settings.api?.client?.linkvertise?.cooldownTime || 3600 %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Note: Cooldown is currently disabled in code</p>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Linkvertise Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-afk" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">AFK System Settings</h3>
                <form id="form-afk" onsubmit="saveSettings(event, 'afk')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="api.afk.enabled" <%= settings.api?.afk?.enabled ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable AFK System</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">WebSocket Path</label>
                      <input type="text" name="api.afk.path" value="<%= settings.api?.afk?.path || 'ws' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Interval (seconds)</label>
                      <input type="number" name="api.afk.every" value="<%= settings.api?.afk?.every || 60 %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">How often to award coins (in seconds)</p>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Coins per Interval</label>
                      <input type="number" name="api.afk.coins" value="<%= settings.api?.afk?.coins || 1 %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save AFK Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-security" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700 mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Anti-VPN Settings</h3>
                <form id="form-antivpn" onsubmit="saveSettings(event, 'antivpn')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="antivpn.status" <%= settings.antivpn?.status ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Anti-VPN</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ProxyCheck.io API Key</label>
                      <input type="password" name="antivpn.APIKey" value="<%= settings.antivpn?.APIKey || '' %>" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Get your key from proxycheck.io</p>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Whitelisted IPs (one per line)</label>
                      <textarea name="antivpn.whitelistedIPs" rows="3" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                        placeholder="192.168.1.1"><%= settings.antivpn?.whitelistedIPs ? (Array.isArray(settings.antivpn.whitelistedIPs) ? settings.antivpn.whitelistedIPs.join('\n') : settings.antivpn.whitelistedIPs) : '' %></textarea>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">IPs that bypass VPN check</p>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Anti-VPN Settings
                  </button>
                </form>
              </div>

              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Whitelist Settings</h3>
                <form id="form-whitelist" onsubmit="saveSettings(event, 'whitelist')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="whitelist.status" <%= settings.whitelist?.status ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Whitelist Mode</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Whitelisted User IDs</label>
                      <textarea name="whitelist.users" rows="4" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                        placeholder="One Discord User ID per line"><%= settings.whitelist?.users ? (Array.isArray(settings.whitelist.users) ? settings.whitelist.users.join('\n') : settings.whitelist.users) : '' %></textarea>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Enter Discord User IDs, one per line</p>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Whitelist Settings
                  </button>
                </form>
              </div>
            </div>

            <div id="tab-logging" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Webhook Logging Settings</h3>
                <form id="form-logging" onsubmit="saveSettings(event, 'logging')">
                  <div class="space-y-6">
                    <div class="flex items-center">
                      <input type="checkbox" name="logging.status" <%= settings.logging?.status ? 'checked' : '' %> 
                        class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                      <label class="ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300">Enable Webhook Logging</label>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Discord Webhook ID</label>
                      <input type="text" name="logging.webhookId" value="<%= settings.logging?.webhookId || '' %>" 
                        placeholder="1234567890123456789"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">The webhook ID from your Discord webhook URL</p>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Discord Webhook Token</label>
                      <input type="text" name="logging.webhookToken" value="<%= settings.logging?.webhookToken || '' %>" 
                        placeholder="abcdefghijklmnopqrstuvwxyz123456789"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">The webhook token from your Discord webhook URL</p>
                    </div>
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">User Actions to Log</h4>
                      <div class="space-y-2">
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.user.signup" <%= settings.logging?.actions?.user?.signup ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">User Signup</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.user.create server" <%= settings.logging?.actions?.user?.['create server'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Create Server</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.user.gifted coins" <%= settings.logging?.actions?.user?.['gifted coins'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Gifted Coins</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.user.modify server" <%= settings.logging?.actions?.user?.['modify server'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Modify Server</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.user.buy ram" <%= settings.logging?.actions?.user?.['buy ram'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Buy RAM</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.user.buy cpu" <%= settings.logging?.actions?.user?.['buy cpu'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Buy CPU</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.user.buy disk" <%= settings.logging?.actions?.user?.['buy disk'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Buy Disk</span>
                        </label>
                      </div>
                    </div>
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Admin Actions to Log</h4>
                      <div class="space-y-2">
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.admin.set coins" <%= settings.logging?.actions?.admin?.['set coins'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Set Coins</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.admin.add coins" <%= settings.logging?.actions?.admin?.['add coins'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Add Coins</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.admin.set resources" <%= settings.logging?.actions?.admin?.['set resources'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Set Resources</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" name="logging.actions.admin.remove account" <%= settings.logging?.actions?.admin?.['remove account'] ? 'checked' : '' %> 
                            class="h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600">
                          <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Remove Account</span>
                        </label>
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition">
                    Save Logging Settings
                  </button>
                </form>
              </div>
            </div>

            <!-- Codes Tab -->
            <div id="tab-codes" class="tab-content hidden">
              <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">Code Management</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Create and manage redemption codes for users to receive coins and resources.</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <!-- Create Code Form -->
                  <div>
                    <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100 mb-4">Create New Code</h4>
                    <div class="bg-gray-50 dark:bg-gray-900 rounded-xl p-6 space-y-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Custom Code (Optional)</label>
                        <input type="text" id="create-code-custom" placeholder="Leave empty for auto-generate" 
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 uppercase" 
                          maxlength="20">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Leave empty to auto-generate (XXXX-XXXX-XXXX)</p>
                      </div>
                      
                      <div class="grid grid-cols-2 gap-3">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Coins</label>
                          <input type="number" id="create-code-coins" placeholder="0" min="0"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">RAM (MB)</label>
                          <input type="number" id="create-code-ram" placeholder="0" min="0"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Disk (MB)</label>
                          <input type="number" id="create-code-disk" placeholder="0" min="0"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">CPU (%)</label>
                          <input type="number" id="create-code-cpu" placeholder="0" min="0"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Server Slots</label>
                          <input type="number" id="create-code-servers" placeholder="0" min="0"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Uses (Total)</label>
                          <input type="number" id="create-code-maxuses" placeholder="999999" min="1" value="999999"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 text-sm">
                          <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">All users combined</p>
                        </div>
                      </div>
                      
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Uses Per User</label>
                        <input type="number" id="create-code-maxuses-per-user" placeholder="1" min="1" value="1"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">How many times each user can redeem this code</p>
                      </div>
                      
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Expires In (Days)</label>
                        <input type="number" id="create-code-expires" placeholder="0 = Never" min="0"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Leave as 0 for never expiring</p>
                      </div>
                      
                      <button onclick="createCode()" 
                        class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-medium transition shadow-lg">
                        Create Code
                      </button>
                      
                      <div id="create-code-message" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                    </div>
                  </div>
                  
                  <!-- Codes List -->
                  <div>
                    <div class="flex items-center justify-between mb-4">
                      <h4 class="text-md font-semibold text-gray-900 dark:text-gray-100">Active Codes</h4>
                      <button onclick="loadCodes()" class="px-3 py-1.5 text-xs bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg font-medium transition">
                        Refresh
                      </button>
                    </div>
                    <div id="codes-list" class="space-y-3 max-h-[600px] overflow-y-auto"></div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </main>
      <%- include('../components/footer') %>
    </div>
  </div>

  <script>
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById('tab-' + tabName).classList.remove('hidden');
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    async function saveSettings(event, category) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      const updates = [];

      for (let [key, value] of formData.entries()) {
        // Handle checkboxes
        const input = form.querySelector(`[name="${key}"]`);
        if (input && input.type === 'checkbox') {
          value = input.checked;
        }
        
        // Handle textareas with array data (like whitelist.users)
        if (input && input.tagName === 'TEXTAREA' && key.includes('users')) {
          value = value.split('\n').filter(line => line.trim()).map(line => line.trim());
          value = JSON.stringify(value);
        }

        // Handle number inputs
        if (input && input.type === 'number') {
          value = parseInt(value) || 0;
        }

        updates.push({ key, value });
      }

      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';

      try {
        for (const update of updates) {
          const response = await fetch(`/settings/update?setting=${encodeURIComponent(update.key)}&value=${encodeURIComponent(update.value)}`);
          if (!response.ok) {
            throw new Error(`Failed to update ${update.key}`);
          }
        }
        
        window.location.href = '/settings?success=1';
      } catch (error) {
        console.error('Error saving settings:', error);
        window.location.href = '/settings?error=' + encodeURIComponent(error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    }

    // ========= CODE MANAGEMENT FUNCTIONS =========
    
    // Create a new code
    async function createCode() {
      const customCode = document.getElementById('create-code-custom').value.trim();
      const coins = parseInt(document.getElementById('create-code-coins').value) || 0;
      const ram = parseInt(document.getElementById('create-code-ram').value) || 0;
      const disk = parseInt(document.getElementById('create-code-disk').value) || 0;
      const cpu = parseInt(document.getElementById('create-code-cpu').value) || 0;
      const servers = parseInt(document.getElementById('create-code-servers').value) || 0;
      const maxUses = parseInt(document.getElementById('create-code-maxuses').value) || 999999;
      const maxUsesPerUser = parseInt(document.getElementById('create-code-maxuses-per-user').value) || 1;
      const expiresIn = parseInt(document.getElementById('create-code-expires').value) || 0;
      const messageDiv = document.getElementById('create-code-message');
      
      if (coins === 0 && ram === 0 && disk === 0 && cpu === 0 && servers === 0) {
        messageDiv.textContent = '❌ Please specify at least one resource';
        messageDiv.className = 'mt-3 p-3 rounded-lg text-sm bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700';
        messageDiv.classList.remove('hidden');
        return;
      }
      
      try {
        const response = await fetch('/admin/codes/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            customCode,
            coins,
            ram,
            disk,
            cpu,
            servers,
            maxUses,
            maxUsesPerUser,
            expiresIn
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          messageDiv.innerHTML = `✅ Code created: <strong class="font-mono bg-green-200 dark:bg-green-800 px-2 py-1 rounded">${data.code.code}</strong>`;
          messageDiv.className = 'mt-3 p-3 rounded-lg text-sm bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 border border-green-300 dark:border-green-700';
          messageDiv.classList.remove('hidden');
          
          document.getElementById('create-code-custom').value = '';
          document.getElementById('create-code-coins').value = '';
          document.getElementById('create-code-ram').value = '';
          document.getElementById('create-code-disk').value = '';
          document.getElementById('create-code-cpu').value = '';
          document.getElementById('create-code-servers').value = '';
          document.getElementById('create-code-maxuses').value = '999999';
          document.getElementById('create-code-maxuses-per-user').value = '1';
          document.getElementById('create-code-expires').value = '';
          
          loadCodes();
        } else {
          messageDiv.textContent = '❌ ' + data.error;
          messageDiv.className = 'mt-3 p-3 rounded-lg text-sm bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700';
          messageDiv.classList.remove('hidden');
        }
      } catch (error) {
        messageDiv.textContent = '❌ Failed to create code';
        messageDiv.className = 'mt-3 p-3 rounded-lg text-sm bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700';
        messageDiv.classList.remove('hidden');
      }
    }
    
    // Load all codes
    async function loadCodes() {
      try {
        const response = await fetch('/admin/codes/list');
        const data = await response.json();
        const codesList = document.getElementById('codes-list');
        
        if (!data.codes || data.codes.length === 0) {
          codesList.innerHTML = '<div class="text-center py-12 text-gray-500 dark:text-gray-400 text-sm">No codes created yet</div>';
          return;
        }
        
        codesList.innerHTML = '';
        data.codes.forEach(code => {
          const isExpired = code.expiresAt && Date.now() > code.expiresAt;
          const isFullyUsed = code.uses >= code.maxUses;
          const isInactive = isExpired || isFullyUsed;
          
          const rewards = [];
          if (code.rewards.coins > 0) rewards.push(`💰 ${code.rewards.coins} coins`);
          if (code.rewards.ram > 0) rewards.push(`🎮 ${code.rewards.ram}MB RAM`);
          if (code.rewards.disk > 0) rewards.push(`💾 ${code.rewards.disk}MB Disk`);
          if (code.rewards.cpu > 0) rewards.push(`⚡ ${code.rewards.cpu}% CPU`);
          if (code.rewards.servers > 0) rewards.push(`🖥️ ${code.rewards.servers} servers`);
          
          const div = document.createElement('div');
          div.className = `bg-gray-50 dark:bg-gray-900 rounded-xl p-4 border ${isInactive ? 'border-red-300 dark:border-red-700 opacity-60' : 'border-gray-200 dark:border-gray-700'}`;
          div.innerHTML = `
            <div class="flex items-start justify-between mb-3">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <code class="text-lg font-bold text-blue-600 dark:text-blue-400">${code.code}</code>
                  ${isExpired ? '<span class="text-xs bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-2 py-0.5 rounded">Expired</span>' : ''}
                  ${isFullyUsed ? '<span class="text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 px-2 py-0.5 rounded">Used Up</span>' : ''}
                </div>
                <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                  <div class="flex flex-wrap gap-1">
                    ${rewards.join(' ')}
                  </div>
                  <div>Total Uses: ${code.uses}/${code.maxUses}</div>
                  <div>Per User Limit: ${code.maxUsesPerUser}</div>
                  ${code.expiresAt ? `<div>Expires: ${new Date(code.expiresAt).toLocaleDateString()}</div>` : '<div>Never expires</div>'}
                </div>
              </div>
              <button onclick="deleteCode('${code.code}')" 
                class="px-3 py-1.5 text-xs bg-red-500 hover:bg-red-600 text-white rounded-lg transition">
                Delete
              </button>
            </div>
          `;
          codesList.appendChild(div);
        });
      } catch (error) {
        console.error('Failed to load codes:', error);
        document.getElementById('codes-list').innerHTML = '<div class="text-center py-8 text-red-500 text-sm">Failed to load codes</div>';
      }
    }
    
    // Delete a code
    async function deleteCode(code) {
      if (!confirm(`Are you sure you want to delete code ${code}?`)) return;
      
      try {
        const response = await fetch(`/admin/codes/delete/${code}`, {
          method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
          loadCodes();
        } else {
          alert('Failed to delete code: ' + data.error);
        }
      } catch (error) {
        alert('Failed to delete code');
      }
    }

    // Load codes when codes tab is opened
    document.addEventListener('DOMContentLoaded', function() {
      const codesTab = document.querySelector('[onclick*="codes"]');
      if (codesTab) {
        codesTab.addEventListener('click', function() {
          setTimeout(loadCodes, 100);
        });
      }
    });

    // Announcement preview functionality
    function updateAnnouncementPreview() {
      const enabled = document.querySelector('input[name="announcement.enabled"]').checked;
      const message = document.querySelector('textarea[name="announcement.message"]').value;
      const type = document.querySelector('select[name="announcement.type"]').value;
      const dismissible = document.querySelector('input[name="announcement.dismissible"]').checked;
      const preview = document.getElementById('announcement-preview');
      
      if (!enabled || !message) {
        preview.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm text-center py-8">Enable announcement and add a message to see preview</p>';
        preview.className = 'rounded-lg p-4 border border-gray-200 dark:border-gray-700';
        return;
      }
      
      const typeColors = {
        info: { bg: 'bg-blue-50 dark:bg-blue-900/20', border: 'border-blue-200 dark:border-blue-800', text: 'text-blue-800 dark:text-blue-200', icon: 'text-blue-400' },
        success: { bg: 'bg-green-50 dark:bg-green-900/20', border: 'border-green-200 dark:border-green-800', text: 'text-green-800 dark:text-green-200', icon: 'text-green-400' },
        warning: { bg: 'bg-yellow-50 dark:bg-yellow-900/20', border: 'border-yellow-200 dark:border-yellow-800', text: 'text-yellow-800 dark:text-yellow-200', icon: 'text-yellow-400' },
        error: { bg: 'bg-red-50 dark:bg-red-900/20', border: 'border-red-200 dark:border-red-800', text: 'text-red-800 dark:text-red-200', icon: 'text-red-400' }
      };
      
      const icons = {
        info: '<path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-7-4a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM9 9a.75.75 0 0 0 0 1.5h.253a.25.25 0 0 1 .244.304l-.459 2.066A1.75 1.75 0 0 0 10.747 15H11a.75.75 0 0 0 0-1.5h-.253a.25.25 0 0 1-.244-.304l.459-2.066A1.75 1.75 0 0 0 9.253 9H9Z" clip-rule="evenodd" />',
        success: '<path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z" clip-rule="evenodd" />',
        warning: '<path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />',
        error: '<path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z" clip-rule="evenodd" />'
      };
      
      const colors = typeColors[type];
      const icon = icons[type];
      
      preview.className = `rounded-lg p-4 border ${colors.bg} ${colors.border}`;
      preview.innerHTML = `
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 ${colors.icon}" viewBox="0 0 20 20" fill="currentColor">
              ${icon}
            </svg>
          </div>
          <div class="ml-3 flex-1">
            <p class="text-sm font-medium ${colors.text}">${message}</p>
          </div>
          ${dismissible ? `
          <div class="ml-3 flex-shrink-0">
            <button class="inline-flex rounded-md p-1.5 hover:bg-black/5 dark:hover:bg-white/5">
              <svg class="h-5 w-5 ${colors.text}" viewBox="0 0 20 20" fill="currentColor">
                <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
              </svg>
            </button>
          </div>
          ` : ''}
        </div>
      `;
    }
    
    // Initialize preview on page load and update on changes
    document.addEventListener('DOMContentLoaded', function() {
      const announcementInputs = ['announcement.enabled', 'announcement.message', 'announcement.type', 'announcement.dismissible'];
      
      announcementInputs.forEach(name => {
        const element = document.querySelector(`[name="${name}"]`);
        if (element) {
          element.addEventListener('change', updateAnnouncementPreview);
          element.addEventListener('input', updateAnnouncementPreview);
        }
      });
      
      // Initial preview
      updateAnnouncementPreview();
      
      // Load health status if on health tab
      if (window.location.hash === '#health') {
        refreshHealthStatus();
      }
    });

    // Health Monitoring functions
    async function refreshHealthStatus() {
      const container = document.getElementById('health-status-container');
      if (!container) return;
      
      // Show loading
      container.innerHTML = `
        <div class="text-center py-8 text-gray-500 dark:text-gray-400 col-span-2">
          <svg class="animate-spin h-8 w-8 mx-auto mb-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p>Loading health status...</p>
        </div>
      `;
      
      try {
        const response = await fetch('/admin/health/status');
        const data = await response.json();
        
        if (!data.success) {
          container.innerHTML = `
            <div class="col-span-2 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300">
              Error: ${data.error}
            </div>
          `;
          return;
        }
        
        const health = data.health;
        
        if (!health.enabled) {
          container.innerHTML = `
            <div class="col-span-2 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg text-gray-600 dark:text-gray-400">
              Health monitoring is currently disabled. Enable it below to start monitoring.
            </div>
          `;
          return;
        }
        
        // Display health checks
        let html = '';
        
        const statusColors = {
          healthy: { bg: 'bg-green-50 dark:bg-green-900/20', border: 'border-green-200 dark:border-green-800', text: 'text-green-700 dark:text-green-300', icon: '✓' },
          warning: { bg: 'bg-yellow-50 dark:bg-yellow-900/20', border: 'border-yellow-200 dark:border-yellow-800', text: 'text-yellow-700 dark:text-yellow-300', icon: '⚠' },
          critical: { bg: 'bg-red-50 dark:bg-red-900/20', border: 'border-red-200 dark:border-red-800', text: 'text-red-700 dark:text-red-300', icon: '✗' },
          error: { bg: 'bg-red-50 dark:bg-red-900/20', border: 'border-red-200 dark:border-red-800', text: 'text-red-700 dark:text-red-300', icon: '✗' }
        };
        
        const checkNames = {
          pterodactyl: 'Pterodactyl Panel',
          database: 'Database',
          diskSpace: 'Disk Space',
          memory: 'Memory'
        };
        
        for (const [key, check] of Object.entries(health.checks || {})) {
          const colors = statusColors[check.status] || statusColors.error;
          html += `
            <div class="p-4 ${colors.bg} rounded-lg border ${colors.border}">
              <div class="flex items-start justify-between mb-2">
                <h5 class="font-semibold ${colors.text}">${checkNames[key] || key}</h5>
                <span class="text-lg">${colors.icon}</span>
              </div>
              <p class="text-sm ${colors.text}">${check.message}</p>
              ${check.usedPercent ? `<div class="mt-2 text-xs ${colors.text}">Used: ${check.used} / ${check.total}</div>` : ''}
            </div>
          `;
        }
        
        container.innerHTML = html || '<div class="col-span-2 text-center text-gray-500">No health checks enabled</div>';
        
      } catch (error) {
        console.error('Failed to load health status:', error);
        container.innerHTML = `
          <div class="col-span-2 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300">
            Failed to load health status. Please try again.
          </div>
        `;
      }
    }

    // User Max Resources functions
    let userMaxResCounter = 0;
    
    function addUserMaxRes() {
      const container = document.getElementById('userMaxResourcesList');
      const newId = 'new_' + Date.now();
      userMaxResCounter++;
      
      const html = `
        <div class="user-max-res-item border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900" data-new="true" data-id="${newId}">
          <div class="flex justify-between items-start mb-4">
            <div class="flex-1">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Discord ID</label>
              <input type="text" name="new_discord_id_${newId}" value="" 
                class="discord-id-input w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
                placeholder="123456789012345678" data-new-id="${newId}">
            </div>
            <button type="button" onclick="removeUserMaxRes(this)" class="ml-4 mt-7 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition">
              Remove
            </button>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max RAM (MB)</label>
              <input type="number" name="new_ram_${newId}" value="0" 
                placeholder="0 = unlimited"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Disk (MB)</label>
              <input type="number" name="new_disk_${newId}" value="0" 
                placeholder="0 = unlimited"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max CPU (%)</label>
              <input type="number" name="new_cpu_${newId}" value="0" 
                placeholder="0 = unlimited"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Server Slots</label>
              <input type="number" name="new_servers_${newId}" value="0" 
                placeholder="0 = unlimited"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
            </div>
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', html);
    }
    
    function removeUserMaxRes(button) {
      const item = button.closest('.user-max-res-item');
      if (confirm('Are you sure you want to remove this user max resource configuration?')) {
        item.remove();
      }
    }
    
    async function saveUserMaxRes(event) {
      event.preventDefault();
      
      const userMaxResources = {};
      const items = document.querySelectorAll('.user-max-res-item');
      
      items.forEach(item => {
        let discordId;
        let ram, disk, cpu, servers;
        
        if (item.dataset.new === 'true') {
          // New item
          const newId = item.dataset.id;
          discordId = document.querySelector(`[name="new_discord_id_${newId}"]`).value.trim();
          ram = parseInt(document.querySelector(`[name="new_ram_${newId}"]`).value) || 0;
          disk = parseInt(document.querySelector(`[name="new_disk_${newId}"]`).value) || 0;
          cpu = parseInt(document.querySelector(`[name="new_cpu_${newId}"]`).value) || 0;
          servers = parseInt(document.querySelector(`[name="new_servers_${newId}"]`).value) || 0;
        } else {
          // Existing item
          const idInput = item.querySelector('.discord-id-input');
          discordId = idInput.value.trim();
          const originalId = idInput.dataset.originalId;
          
          ram = parseInt(item.querySelector(`[name="api.client.userMaxResources.${originalId}.ram"]`).value) || 0;
          disk = parseInt(item.querySelector(`[name="api.client.userMaxResources.${originalId}.disk"]`).value) || 0;
          cpu = parseInt(item.querySelector(`[name="api.client.userMaxResources.${originalId}.cpu"]`).value) || 0;
          servers = parseInt(item.querySelector(`[name="api.client.userMaxResources.${originalId}.servers"]`).value) || 0;
        }
        
        if (discordId) {
          userMaxResources[discordId] = { ram, disk, cpu, servers };
        }
      });
      
      try {
        const response = await fetch('/admin/settings/update', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            path: 'api.client.userMaxResources',
            value: userMaxResources
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('✅ User max resources saved successfully!');
          window.location.reload();
        } else {
          alert('❌ Error: ' + data.error);
        }
      } catch (error) {
        alert('❌ Failed to save user max resources');
        console.error(error);
      }
    }

    // Social Media Links functions
    function addSocialLink() {
      const container = document.getElementById('social-media-links');
      const timestamp = Date.now();
      
      const html = `
        <div class="social-link-item border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900" data-new="true" data-id="${timestamp}">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Platform Name</label>
              <input type="text" class="link-name w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" 
                value="" placeholder="Discord">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Icon</label>
              <select class="link-icon w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500">
                <optgroup label="Social Media">
                  <option value="discord">Discord</option>
                  <option value="twitter">Twitter/X</option>
                  <option value="instagram">Instagram</option>
                  <option value="youtube">YouTube</option>
                  <option value="github">GitHub</option>
                  <option value="facebook">Facebook</option>
                  <option value="tiktok">TikTok</option>
                  <option value="reddit">Reddit</option>
                  <option value="linkedin">LinkedIn</option>
                  <option value="twitch">Twitch</option>
                </optgroup>
                <optgroup label="Services & Pages">
                  <option value="website">🌐 Website/Home</option>
                  <option value="panel">⚙️ Control Panel</option>
                  <option value="status">📊 Status Page</option>
                  <option value="docs">📚 Documentation</option>
                  <option value="support">💬 Support/Help</option>
                  <option value="blog">📝 Blog</option>
                  <option value="store">🛒 Store/Shop</option>
                  <option value="community">👥 Community/Forum</option>
                  <option value="wiki">📖 Wiki</option>
                  <option value="api">🔌 API Docs</option>
                  <option value="billing">💳 Billing</option>
                  <option value="downloads">⬇️ Downloads</option>
                  <option value="news">📰 News</option>
                </optgroup>
                <optgroup label="General">
                  <option value="link">🔗 Generic Link</option>
                  <option value="email">📧 Email</option>
                </optgroup>
              </select>
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">URL</label>
              <div class="flex gap-2">
                <input type="url" class="link-url flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500" 
                  value="" placeholder="https://...">
                <div class="flex items-center gap-2">
                  <input type="checkbox" class="link-enabled h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600" checked>
                  <label class="text-sm text-gray-600 dark:text-gray-400">Enabled</label>
                  <button type="button" onclick="removeSocialLink(this)" class="ml-2 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition">
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', html);
    }
    
    function removeSocialLink(button) {
      const item = button.closest('.social-link-item');
      if (confirm('Are you sure you want to remove this social link?')) {
        item.remove();
      }
    }
    
    async function saveSocialMedia(event) {
      event.preventDefault();
      
      const enabled = document.getElementById('social-media-enabled').checked;
      const items = document.querySelectorAll('.social-link-item');
      const links = [];
      
      items.forEach(item => {
        const name = item.querySelector('.link-name').value.trim();
        const icon = item.querySelector('.link-icon').value;
        const url = item.querySelector('.link-url').value.trim();
        const linkEnabled = item.querySelector('.link-enabled').checked;
        
        if (name && url) {
          links.push({
            name,
            icon,
            url,
            enabled: linkEnabled
          });
        }
      });
      
      const socialMediaConfig = {
        enabled,
        links
      };
      
      try {
        const response = await fetch('/admin/settings/update', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            path: 'socialMedia',
            value: socialMediaConfig
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('✅ Social media links saved successfully!');
          window.location.reload();
        } else {
          alert('❌ Error: ' + data.error);
        }
      } catch (error) {
        alert('❌ Failed to save social media links');
        console.error(error);
      }
    }
  </script>
</body>
</html>
